[Metadata]
Name=Fountain of Colors
Author=alatsombath
Version=05 March 2015 rev
License=Creative Commons Attribution-Non-Commercial-Share Alike 3.0
Information=A music visualizer for Rainmeter

[Rainmeter]
Update=16
AccurateText=1

ContextTitle="Edit variables"
ContextAction=["#@#Variables.inc"]
ContextTitle2="Edit color playlists"
ContextAction2=["#@#ColorPlaylists.inc"]

@Include=#@#Variables.inc

[MeasureAudio]
Measure=Plugin
Plugin=AudioLevel
Port=Output
FFTSize=#FFTSize#
FFTOverlap=(#FFTSize#/2)
FFTAttack=#FFTAttack#
FFTDecay=#FFTDecay#
Bands=#Bands#
FreqMin=#FreqMin#
FreqMax=#FreqMax#
Sensitivity=#Sensitivity#

[MeterBar]
X=(#BarGapX#*#SkinSizeRatio#)R
Y=(#BarGapY#*#SkinSizeRatio#)
W=(#BarWidth#*#SkinSizeRatio#)
H=(#BarHeight#*#SkinSizeRatio#)

[FirstMeter]
Meter=Bar
MeasureName=MeasureAudio
X=(-#BarGapX#*#SkinSizeRatio#)
UpdateDivider=-1

[ScriptRepeatBands]
Measure=Script
ScriptFile=#@#RepeatSection.lua
ReadFile=#@#ReadBands.inc
WriteFile=#@#WriteBands.inc
Sub=Repeat
Index=1
Limit=(#Bands#-1)
@Include=#@#WriteBands.inc

[ScriptColorFactory]
Measure=Script
ScriptFile=#@#ColorFactory.lua
Sub=Repeat
Index=1
Limit=(#Bands#-1)

[MeasureNowPlaying]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=COVER
TrackChangeAction=[!ShowFade]

[MeasureArtist]
Measure=Plugin
Plugin=NowPlaying
PlayerName=[MeasureNowPlaying]
PlayerType=ARTIST

[MeasureAlbum]
Measure=Plugin
Plugin=NowPlaying
PlayerName=[MeasureNowPlaying]
PlayerType=ALBUM

[MeasureTrack]
Measure=Plugin
Plugin=NowPlaying
PlayerName=[MeasureNowPlaying]
PlayerType=TITLE

[MeasureTrackPosition]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=POSITION

[MeasureTrackDuration]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=DURATION
IfMatch=00:00
IfMatchAction=[!HideMeter MeterTrackPositionDuration][!HideMeter MeterPrevious][!HideMeter MeterPlayPause][!HideMeter MeterNext]
IfNotMatchAction=[!ShowMeter MeterTrackPositionDuration][!ShowMeter MeterPrevious][!ShowMeter MeterPlayPause][!ShowMeter MeterNext]

[MeasureTrackProgress]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=PROGRESS
IfMatch=99
IfMatchAction=[!HideFade]

[MeasureTrackState]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=STATE
Substitute="0":"#@#/ic_play_arrow_white_48dp.png","1":"#@#/ic_pause_white_48dp.png","2":"#@#/ic_play_arrow_white_48dp.png"

[InfoFileName]
Measure=String
String=[MeasureArtist][MeasureAlbum]
DynamicVariables=1
Substitute=" ":"",",":"","'":"","&":"","(":"",")":"",":":""
OnChangeAction=[!SetVariable NewAlbum [InfoFileName]][!UpdateMeasure AlbumArtModeCheck]

[AlbumArtModeCheck]
Measure=String
String=#ColorPlaylist#
DynamicVariables=1
IfMatch=AlbumArt
IfMatchMode=1
IfMatchAction=[!UpdateMeasure NewAlbumCheck]
UpdateDivider=-1

[NewAlbumCheck]
Measure=String
String=#CurrentAlbum#
DynamicVariables=1
IfMatch=#NewAlbum#
IfNotMatchAction=[!SetVariable CurrentAlbum #NewAlbum#][!UpdateMeasure NewAlbumCheck][!CommandMeasure ScriptColorFactory AlbumArt()]
UpdateDivider=-1

[UploadArtGetColorsInfo]
Measure=Plugin
Plugin=RunCommand
Program=#@#curl.exe
Parameter=--data-urlencode "image@[MeasureNowPlaying]" http://pictaculous.com/api/1.0/ -o "#CURRENTPATH#\DownloadFile\[InfoFileName].txt"
State=Hide
DynamicVariables=1
FinishAction=[!Refresh]

[MeterTrackProgress]
Meter=Bar
MeasureName=MeasureTrackProgress
X=(0*#SkinSizeRatio#)
Y=(12*#SkinSizeRatio#)R
W=#CURRENTCONFIGWIDTH#
H=(6*#SkinSizeRatio#)
BarColor=255,255,255
BarOrientation=Horizontal

[One]
Measure=Calc
Formula=1
UpdateDivider=-1

[SeekOffset]
Measure=Calc
OnChangeAction=[!CommandMeasure MeasureNowPlaying "SetPosition [SeekOffset]"]

[MeterTrackProgressBackground]
Meter=Bar
MeasureName=One
X=(0*#SkinSizeRatio#)
Y=(0*#SkinSizeRatio#)r
W=#CURRENTCONFIGWIDTH#
H=(6*#SkinSizeRatio#)
DynamicVariables=1
BarColor=255,255,255,1
BarOrientation=Horizontal
LeftMouseDownAction=[!SetOption SeekOffset Formula $MouseX:%$+1]

[MeterAlbumArt]
Meter=Image
MeasureName=MeasureNowPlaying
PreserveAspectRatio=1
X=(0*#SkinSizeRatio#)
Y=(12*#SkinSizeRatio#)R
W=(250*#SkinSizeRatio#)
H=(250*#SkinSizeRatio#)

[MeterArtist]
Meter=String
MeasureName=MeasureArtist
X=(24*#SkinSizeRatio#)R
Y=(0*#SkinSizeRatio#)r
FontFace=#PrimaryFont#
FontSize=(48*#SkinSizeRatio#)
FontColor=#FontColor#
AntiAlias=1
StringEffect=Shadow

[MeterTrack]
Meter=String
MeasureName=MeasureTrack
X=(1*#SkinSizeRatio#)r
Y=(72*#SkinSizeRatio#)r
FontFace=#SecondaryFont#
FontSize=(36*#SkinSizeRatio#)
FontColor=#FontColor#
AntiAlias=1
StringEffect=Shadow

[MeterTrackPositionDuration]
Meter=String
MeasureName=MeasureTrackPosition
MeasureName2=MeasureTrackDuration
Text=%1 / %2
X=(2*#SkinSizeRatio#)r
Y=(72*#SkinSizeRatio#)r
FontFace=#SecondaryFont#
FontSize=(16*#SkinSizeRatio#)
FontColor=#FontColor#
AntiAlias=1
StringEffect=Shadow

[MeterPrevious]
Meter=Image
ImageName=#@#/ic_skip_previous_white_48dp.png
X=(-14*#SkinSizeRatio#)r
Y=(36*#SkinSizeRatio#)r
W=(64*#SkinSizeRatio#)
H=(64*#SkinSizeRatio#)
AntiAlias=1
LeftMouseUpAction=[!CommandMeasure MeasureNowPlaying Previous]

[MeterPlayPause]
Meter=Image
ImageName=[MeasureTrackState]
DynamicVariables=1
X=(8*#SkinSizeRatio#)R
Y=(0*#SkinSizeRatio#)r
W=(64*#SkinSizeRatio#)
H=(64*#SkinSizeRatio#)
AntiAlias=1
LeftMouseUpAction=[!CommandMeasure MeasureNowPlaying PlayPause]

[MeterNext]
Meter=Image
ImageName=#@#/ic_skip_next_white_48dp.png
X=(8*#SkinSizeRatio#)R
Y=(0*#SkinSizeRatio#)r
W=(64*#SkinSizeRatio#)
H=(64*#SkinSizeRatio#)
AntiAlias=1
LeftMouseUpAction=[!CommandMeasure MeasureNowPlaying Next]

@Include=#@#ColorPlaylists.inc