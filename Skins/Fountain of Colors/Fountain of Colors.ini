[Metadata]
Name=Fountain of Colors
Author=alatsombath
Version=05 March 2015
License=Creative Commons Attribution-Non-Commercial-Share Alike 3.0
Information=A music visualizer for Rainmeter

[Rainmeter]
Update=16

@Include=#@#Variables.inc

[MeasureAudio]
Measure=Plugin
Plugin=AudioLevel
Port=Output
FFTSize=#FFTSize#
FFTOverlap=(#FFTSize#/2)
FFTAttack=#FFTAttack#
FFTDecay=#FFTDecay#
Bands=#Bands#
FreqMin=#FreqMin#
FreqMax=#FreqMax#
Sensitivity=#Sensitivity#

[MeterBar]
X=#BarGapX#R
Y=#BarGapY#
W=#BarWidth#
H=#BarHeight#

[ScriptRepeatBands]
Measure=Script
ScriptFile=#@#RepeatSection.lua
ReadFile=#@#ReadBands.inc
WriteFile=#@#WriteBands.inc
Sub=Repeat
Index=1
Limit=(#Bands#-1)
@Include=#@#WriteBands.inc

[ScriptColorChanger]
Measure=Script
ScriptFile=#@#ColorChanger.lua
Sub=Repeat
Index=1
Limit=(#Bands#-1)

[MeasureNowPlaying]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=COVER
TrackChangeAction=[!ShowFade]

[MeasureArtist]
Measure=Plugin
Plugin=NowPlaying
PlayerName=[MeasureNowPlaying]
PlayerType=ARTIST

[MeasureAlbum]
Measure=Plugin
Plugin=NowPlaying
PlayerName=[MeasureNowPlaying]
PlayerType=ALBUM

[MeasureTrack]
Measure=Plugin
Plugin=NowPlaying
PlayerName=[MeasureNowPlaying]
PlayerType=TITLE

[MeasureTrackPosition]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=POSITION

[MeasureTrackDuration]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=DURATION
IfMatch=00:00
IfMatchAction=[!HideMeter MeterTrackPositionDuration][!HideMeter MeterPrevious][!HideMeter MeterPlayPause][!HideMeter MeterNext]
IfNotMatchAction=[!ShowMeter MeterTrackPositionDuration][!ShowMeter MeterPrevious][!ShowMeter MeterPlayPause][!ShowMeter MeterNext]

[MeasureTrackProgress]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=PROGRESS
IfMatch=99
IfMatchAction=[!HideFade]

[MeasureTrackState]
Measure=Plugin
Plugin=NowPlaying
PlayerName=#PlayerName#
PlayerType=STATE
Substitute="0":"#@#/ic_play_arrow_white_48dp.png","1":"#@#/ic_pause_white_48dp.png","2":"#@#/ic_play_arrow_white_48dp.png"

[InfoFileName]
Measure=String
String=[MeasureArtist][MeasureAlbum]
DynamicVariables=1
Substitute=" ":"",",":"","'":"","&":"","(":"",")":"",":":""
OnChangeAction=[!SetVariable NewAlbum [InfoFileName]][!UpdateMeasure AlbumArtModeCheck]

[AlbumArtModeCheck]
Measure=String
String=#ColorPlaylist#
DynamicVariables=1
IfMatch=AlbumArt
IfMatchMode=1
IfMatchAction=[!UpdateMeasure NewAlbumCheck]
UpdateDivider=-1

[NewAlbumCheck]
Measure=String
String=#CurrentAlbum#
DynamicVariables=1
IfMatch=#NewAlbum#
IfNotMatchAction=[!SetVariable CurrentAlbum #NewAlbum#][!UpdateMeasure NewAlbumCheck][!CommandMeasure ScriptColorChanger AlbumArt()]
UpdateDivider=-1

[UploadArtGetColorsInfo]
Measure=Plugin
Plugin=RunCommand
Program=#@#curl.exe
Parameter=--data-urlencode "image@[MeasureNowPlaying]" http://pictaculous.com/api/1.0/ -o "#CURRENTPATH#\DownloadFile\[InfoFileName].txt"
State=Hide
DynamicVariables=1
FinishAction=[!Refresh]

[MeterTrackProgress]
Meter=Bar
MeasureName=MeasureTrackProgress
X=#BarGapX#
Y=12R
W=(#BarGapX#*(#Bands#-3) + #BarWidth#*(#Bands#-4))
H=6
BarColor=255,255,255
BarOrientation=Horizontal

[MeterAlbumArt]
Meter=Image
MeasureName=MeasureNowPlaying
PreserveAspectRatio=1
X=#BarGapX#
Y=12R
W=250
H=250

[MeterArtist]
Meter=String
MeasureName=MeasureArtist
X=24R
Y=0r
FontFace=Segoe UI
FontSize=48
FontColor=255,255,255
AntiAlias=1
StringEffect=Shadow

[MeterTrack]
Meter=String
MeasureName=MeasureTrack
X=4r
Y=72r
FontFace=Segoe UI Semilight
FontSize=36
FontColor=255,255,255
AntiAlias=1
StringEffect=Shadow

[MeterTrackPositionDuration]
Meter=String
MeasureName=MeasureTrackPosition
MeasureName2=MeasureTrackDuration
Text=%1 / %2
X=8r
Y=72r
FontFace=Segoe UI Semilight
FontSize=16
FontColor=255,255,255
AntiAlias=1
StringEffect=Shadow

[MeterPrevious]
Meter=Image
ImageName=#@#/ic_skip_previous_white_48dp.png
X=-12r
Y=36r
W=64
H=64
AntiAlias=1
LeftMouseUpAction=[!CommandMeasure MeasureNowPlaying Previous]

[MeterPlayPause]
Meter=Image
ImageName=[MeasureTrackState]
DynamicVariables=1
X=8R
Y=0r
W=64
H=64
AntiAlias=1
LeftMouseUpAction=[!CommandMeasure MeasureNowPlaying PlayPause]

[MeterNext]
Meter=Image
ImageName=#@#/ic_skip_next_white_48dp.png
X=8R
Y=0r
W=64
H=64
AntiAlias=1
LeftMouseUpAction=[!CommandMeasure MeasureNowPlaying Next]